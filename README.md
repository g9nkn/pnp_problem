# Globally optimal solution to Perspective-n-Point problem

&copy; 2020 NEC Corporation

This repository is an official MATLAB implementation of the paper "Globally Optimal DLS Method for PnP Problem with Cayley parameterization", BMVC2015 [(pdf)](http://www.bmva.org/bmvc/2015/papers/paper078/) [\[1\]](#reference).
Gr&ouml;bner basis solvers used in the code are generated by V. Larsson's automatic generator for polynomial solvers [\[2\]](#reference).  
For Japanese readers: 日本語によるPnP問題の解説は私の博士論文 [\[3\]](#reference) をご一読ください．

## License

This software is released under the NEC Corporation License.
See [LICENSE](https://github.com/g9nkn/pnp_problem/blob/main/LICENSE) before using the code. If you use this code, please cite the paper.

```bibtex
@inproceedings{BMVC2015_78,
   title={Globally Optimal DLS Method for PnP Problem with Cayley parameterization},
   author={Gaku Nakano},
   year={2015},
   month={September},
   pages={78.1-78.11},
   articleno={78},
   numpages={11},
   booktitle={Proceedings of the British Machine Vision Conference (BMVC)},
   publisher={BMVA Press},
   editor={Xianghua Xie, Mark W. Jones, and Gary K. L. Tam},
   doi={10.5244/C.29.78},
   isbn={1-901725-53-7},
   url={https://dx.doi.org/10.5244/C.29.78}
}
```

For commercial use, please contact Gaku Nakano \<g-nakano@nec.com\>.

## Usage

### Install

Copy `pnp_problem` folder and set a path to the folder by `addpath('pnp_problem')`. A subfolder `pnp_problem/private` is automatically linked.

### Function API

```
[R, t, err] = pnp_nakano_bmvc2015(pts3d, pts2d, rot_params)

INPUTS:
  pts3d - 3xN matrix of 3D points corresponding to the 2D points. (N >= 3)
          [x1, x2, ..., xN
           y1, y2, ..., yN
           z1, z2, ..., zN];
  pts2d - 2xN matrix of 2D points corresponding to the 3D points. (N >= 3)
          Each points are normalized by using the intrinsic paramters.
          [u1, u2, ..., uN
           v1, v2, ..., vN];
  rot_params - char to select the paramterization of the PnP problem.
           'rotation_matrix'   : 3x3 Rotation matrix
           'quaternion'        : 4x1 Quaternion
           'cayley' or 'optdls': 3x1 Cayley transformation

OUTPUS:
  R - 3x3xM rotation matrix. R(:,:,i) corresponds to t(:,i) and err(i).
  t - 3xM translation vector.
  err - 1xM algebraic cost of the solution.
```

Run `demo_pnp_nakano_bmvc2015.m` to understand how it works.

### Note

A warning message might be displayed such as `Warning: Matrix is close to singular or badly scaled. Results may be inaccurate. RCOND =  1.343268e-16.` It often happens particulary for the `'rotation_matrix'` paramterization due to a numerical instability caused by the large elimination template of the Gr&ouml;bner basis solver. Thus, the optDLS method proposed in the paper, `'cayley'` or `'optdls'`, is recommended for practical use. Warnings can be disabled by `warning off` on the MATLAB console.

## Reference

1. Gaku Nakano, "Globally Optimal DLS Method for PnP Problem with Cayley parameterization," BMVC2015.  
<http://www.bmva.org/bmvc/2015/papers/paper078/>

2. Viktor Larsson et al., "Efficient Solvers for Minimal Problems by Syzygy-based Reduction," CVPR 2017.  
Code: <http://people.inf.ethz.ch/vlarsson/misc/autogen_v0_5.zip>

3. 中野学，Perspective-n-Point問題とその派生問題に対する安定かつ高速な解法に関する研究，博士論文，筑波大学，2021年3月．
<https://jpn.nec.com/rd/people/docs/doctoral_thesis_nakano.pdf>

## Contributors

- Gaku Nakano, Central Research Laboratories, NEC Corporation.  
<g-nakano@nec.com>  
(ENG) <https://www.nec.com/en/global/rd/people/gaku_nakano.html>  
(JPN) <https://jpn.nec.com/rd/people/gaku_nakano.html>